<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Encrypt/Decrypt myXL xdata (Netlify Functions)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h2 class="mb-4">Encrypt/Decrypt myXL xdata</h2>
    <div class="row g-4">
      <!-- Encrypt -->
      <div class="col-md-6">
        <div class="card shadow">
          <div class="card-header bg-success text-white">
            <b>Encrypt Plaintext</b>
          </div>
          <div class="card-body">
            <form id="encryptForm" autocomplete="off">
              <div class="mb-3">
                <label for="plaintext" class="form-label">Plaintext</label>
                <textarea class="form-control" id="plaintext" rows="3" placeholder="Tulis teks yang mau diencrypt"></textarea>
              </div>
              <div class="mb-3">
                <label for="timestamp" class="form-label">Timestamp (ms)</label>
                <input type="text" class="form-control" id="timestamp" placeholder="e.g. 1753728131246">
                <div class="form-text">
                  Gunakan timestamp dalam milidetik (ms).
                  <a href="#" onclick="setNow();return false;">[pakai sekarang]</a>
                </div>
              </div>
              <div class="mb-3">
                <label for="key" class="form-label">Encryption Key</label>
                <input type="text" class="form-control" id="key" value="880d8e7e9b4b787aa50a3917b09fc0ec">
              </div>
              <button type="submit" class="btn btn-success w-100">Encrypt</button>
            </form>
            <div class="mt-4">
              <label class="form-label">Hasil xdata (Base64 URL-safe):</label>
              <textarea class="form-control" id="xdata" rows="2" readonly></textarea>
            </div>
          </div>
        </div>
      </div>

      <!-- Decrypt -->
      <div class="col-md-6">
        <div class="card shadow">
          <div class="card-header bg-primary text-white">
            <b>Decrypt xdata</b>
          </div>
          <div class="card-body">
            <form id="decryptForm" autocomplete="off">
              <div class="mb-3">
                <label for="xdata2" class="form-label">xdata (Base64 URL-safe)</label>
                <textarea class="form-control" id="xdata2" rows="3" placeholder="Paste xdata di sini"></textarea>
              </div>
              <div class="mb-3">
                <label for="xtime2" class="form-label">xtime (timestamp ms)</label>
                <input type="text" class="form-control" id="xtime2" placeholder="e.g. 1753728131246">
              </div>
              <div class="mb-3">
                <label for="key2" class="form-label">Encryption Key</label>
                <input type="text" class="form-control" id="key2" value="880d8e7e9b4b787aa50a3917b09fc0ec">
              </div>
              <button type="submit" class="btn btn-primary w-100">Decrypt</button>
            </form>
            <div class="mt-4">
              <label class="form-label">Hasil Plaintext:</label>
              <textarea class="form-control" id="plaintext2" rows="8" readonly></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="mt-5 text-center text-muted">
      <small>Encrypt/Decrypt myXL xdata Â© 2024</small>
    </footer>
  </div>

  <script>
    function setNow() {
      document.getElementById('timestamp').value = Date.now();
    }

    // handle encryption
    document.getElementById('encryptForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const plaintext = document.getElementById('plaintext').value.trim();
      const timestamp = document.getElementById('timestamp').value.trim();
      const key       = document.getElementById('key').value.trim();
      if (!plaintext || !timestamp || !key) {
        return alert('Isi semua field!');
      }
      const resp = await fetch('/encrypt', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ plaintext, timestamp, key })
      });
      const data = await resp.json();
      if (resp.ok) {
        document.getElementById('xdata').value = data.xdata;
      } else {
        alert('Error: ' + (data.error || resp.statusText));
      }
    });

    // handle decryption
    document.getElementById('decryptForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const xdata     = document.getElementById('xdata2').value.trim();
      const timestamp = document.getElementById('xtime2').value.trim();
      const key       = document.getElementById('key2').value.trim();
      if (!xdata || !timestamp || !key) {
        return alert('Isi semua field!');
      }
      const resp = await fetch('/decrypt', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ xdata, timestamp, key })
      });
      const data = await resp.json();
      if (resp.ok) {
        document.getElementById('plaintext2').value = data.plaintext;
      } else {
        alert('Error: ' + (data.error || resp.statusText));
      }
    });
  </script>
</body>
</html>
